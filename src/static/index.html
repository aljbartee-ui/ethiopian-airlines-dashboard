<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ethiopian Airlines - Sales Analytics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@2.2.0/dist/chartjs-plugin-datalabels.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a3a1a 0%, #2d5a2d 50%, #1a3a1a 100%);
            background-attachment: fixed;
            color: #fff;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        header {
            text-align: center;
            padding: 30px 20px;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            border: 2px solid rgba(252, 204, 44, 0.3);
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }

        h1 {
            font-size: 3em;
            margin-bottom: 10px;
            background: linear-gradient(90deg, #5C8C4C, #FCCC2C, #C4242B);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            text-shadow: 0 0 30px rgba(252, 204, 44, 0.3);
        }

        .subtitle {
            font-size: 1.2em;
            color: #FCCC2C;
            opacity: 0.9;
        }

        .card {
            background: rgba(255, 255, 255, 0.08);
            backdrop-filter: blur(15px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            border: 2px solid rgba(92, 140, 76, 0.3);
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(252, 204, 44, 0.2);
            border-color: rgba(252, 204, 44, 0.5);
        }

        .card-title {
            font-size: 1.8em;
            margin-bottom: 20px;
            color: #FCCC2C;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .card-title::before {
            content: '';
            width: 5px;
            height: 30px;
            background: linear-gradient(180deg, #5C8C4C, #FCCC2C, #C4242B);
            border-radius: 5px;
        }

        .controls {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
            align-items: center;
        }

        .btn-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: 2px solid rgba(92, 140, 76, 0.5);
            background: rgba(92, 140, 76, 0.2);
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
            font-size: 1em;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        button:hover {
            background: rgba(92, 140, 76, 0.4);
            border-color: #5C8C4C;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(92, 140, 76, 0.3);
        }

        button.active {
            background: linear-gradient(135deg, #5C8C4C, #FCCC2C);
            border-color: #FCCC2C;
            box-shadow: 0 5px 20px rgba(252, 204, 44, 0.4);
        }

        .chart-container {
            position: relative;
            height: 400px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 20px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .date-filter {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
        }

        input[type="date"] {
            padding: 10px 15px;
            border: 2px solid rgba(92, 140, 76, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 10px;
            font-size: 1em;
        }

        input[type="date"]::-webkit-calendar-picker-indicator {
            filter: invert(1);
        }

        .status-badge {
            display: inline-block;
            padding: 8px 16px;
            background: rgba(92, 140, 76, 0.3);
            border: 2px solid #5C8C4C;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .admin-section {
            background: rgba(196, 36, 43, 0.1);
            border-color: rgba(196, 36, 43, 0.3);
        }

        .admin-section:hover {
            border-color: rgba(196, 36, 43, 0.5);
        }

        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 12px 15px;
            margin: 10px 0;
            border: 2px solid rgba(92, 140, 76, 0.5);
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
            border-radius: 10px;
            font-size: 1em;
        }

        input[type="text"]::placeholder, input[type="password"]::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .upload-area {
            border: 3px dashed rgba(252, 204, 44, 0.5);
            border-radius: 15px;
            padding: 40px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: rgba(252, 204, 44, 0.05);
        }

        .upload-area:hover {
            border-color: #FCCC2C;
            background: rgba(252, 204, 44, 0.1);
        }

        .dataset-info {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .info-item {
            padding: 15px;
            background: rgba(92, 140, 76, 0.2);
            border-radius: 10px;
            border: 2px solid rgba(92, 140, 76, 0.3);
        }

        .info-label {
            font-size: 0.9em;
            opacity: 0.8;
            margin-bottom: 5px;
        }

        .info-value {
            font-size: 1.5em;
            font-weight: bold;
            color: #FCCC2C;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 1.2em;
            color: #FCCC2C;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .loading::after {
            content: '...';
            animation: pulse 1.5s infinite;
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 2em;
            }

            .chart-container {
                height: 300px;
            }

            .controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>‚úàÔ∏è Ethiopian Airlines</h1>
            <p class="subtitle">Sales Analytics Dashboard</p>
        </header>

        <!-- System Status -->
        <div class="card">
            <div class="card-title">üìä System Status</div>
            <span class="status-badge">üü¢ Public Mode</span>
        </div>

        <!-- Admin Section -->
        <div class="card admin-section" id="adminSection">
            <div class="card-title">üîê Admin Access</div>
            <div id="loginForm">
                <input type="text" id="username" placeholder="Enter admin username">
                <input type="password" id="password" placeholder="Enter admin password">
                <button onclick="login()">üîê Login as Admin</button>
            </div>
            <div id="adminPanel" style="display: none;">
                <button onclick="logout()">üö™ Logout</button>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <p style="font-size: 1.2em; margin-bottom: 10px;">‚úàÔ∏è Upload Sales Report</p>
                    <p style="opacity: 0.7;">Click or drag and drop Excel file here</p>
                    <input type="file" id="fileInput" accept=".xlsx,.xls" style="display: none;" onchange="uploadFile()">
                </div>
            </div>
        </div>

        <!-- Date Filter -->
        <div class="card">
            <div class="card-title">üìÖ Date Range Filter</div>
            <div class="date-filter">
                <div>
                    <label>Start Date</label>
                    <input type="date" id="startDate" onchange="refreshAllCharts()">
                </div>
                <div>
                    <label>End Date</label>
                    <input type="date" id="endDate" onchange="refreshAllCharts()">
                </div>
                <button onclick="clearDateFilter()">Clear</button>
            </div>
        </div>

        <!-- Dataset Info -->
        <div class="card" id="datasetInfo" style="display: none;">
            <div class="card-title">üìÅ Current Dataset</div>
            <div class="dataset-info">
                <div class="info-item">
                    <div class="info-label">üìÑ File Name</div>
                    <div class="info-value" id="fileName">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">üìÖ Uploaded</div>
                    <div class="info-value" id="uploadDate">-</div>
                </div>
                <div class="info-item">
                    <div class="info-label">üìä Total Records</div>
                    <div class="info-value" id="recordCount">-</div>
                </div>
            </div>
        </div>

        <!-- Chart 1: Sales Report - Time Trend -->
        <div class="card">
            <div class="card-title">üìà Sales Report - Time Trend</div>
            <div class="controls">
                <div class="btn-group">
                    <button class="active" data-metric="revenue" onclick="updateChart1Metric(this)">üí∞ Revenue</button>
                    <button data-metric="tickets" onclick="updateChart1Metric(this)">üé´ Tickets</button>
                    <button data-metric="both" onclick="updateChart1Metric(this)">üìä Both</button>
                </div>
                <div class="btn-group">
                    <button class="active" data-view="daily" onclick="updateChart1View(this)">üìÖ Daily</button>
                    <button data-view="monthly" onclick="updateChart1View(this)">üìÜ Monthly</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart1"></canvas>
            </div>
        </div>

        <!-- Chart 2: Sales by Agent -->
        <div class="card">
            <div class="card-title">üë• Sales by Agent</div>
            <div class="controls">
                <div class="btn-group">
                    <button class="active" data-metric="revenue" onclick="updateChart2Metric(this)">üí∞ Revenue</button>
                    <button data-metric="tickets" onclick="updateChart2Metric(this)">üé´ Tickets</button>
                    <button data-metric="both" onclick="updateChart2Metric(this)">üìä Both</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart2"></canvas>
            </div>
        </div>

        <!-- Chart 3: Sales by Day of Week -->
        <div class="card">
            <div class="card-title">üìÖ Sales by Day of Week</div>
            <div class="controls">
                <div class="btn-group">
                    <button class="active" data-metric="revenue" onclick="updateChart3Metric(this)">üí∞ Revenue</button>
                    <button data-metric="tickets" onclick="updateChart3Metric(this)">üé´ Tickets</button>
                    <button data-metric="both" onclick="updateChart3Metric(this)">üìä Both</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart3"></canvas>
            </div>
        </div>

        <!-- Chart 4: Sales by Hour -->
        <div class="card">
            <div class="card-title">üïê Sales by Hour of Day</div>
            <div class="controls">
                <div class="btn-group">
                    <button class="active" data-metric="revenue" onclick="updateChart4Metric(this)">üí∞ Revenue</button>
                    <button data-metric="tickets" onclick="updateChart4Metric(this)">üé´ Tickets</button>
                    <button data-metric="both" onclick="updateChart4Metric(this)">üìä Both</button>
                </div>
            </div>
            <div class="chart-container">
                <canvas id="chart4"></canvas>
            </div>
        </div>
    </div>

    <script>
        // Chart instances
        let chart1, chart2, chart3, chart4;
        
        // Chart configurations
        const chartConfig = {
            chart1: { metric: 'revenue', view: 'daily' },
            chart2: { metric: 'revenue' },
            chart3: { metric: 'revenue' },
            chart4: { metric: 'revenue' }
        };

        // Ethiopian Airlines colors
        const colors = {
            green: '#5C8C4C',
            yellow: '#FCCC2C',
            red: '#C4242B',
            greenGradient: (ctx) => {
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(92, 140, 76, 0.8)');
                gradient.addColorStop(1, 'rgba(92, 140, 76, 0.2)');
                return gradient;
            },
            yellowGradient: (ctx) => {
                const gradient = ctx.createLinearGradient(0, 0, 0, 400);
                gradient.addColorStop(0, 'rgba(252, 204, 44, 0.8)');
                gradient.addColorStop(1, 'rgba(252, 204, 44, 0.2)');
                return gradient;
            }
        };

        // Common chart options
        const commonOptions = {
            responsive: true,
            maintainAspectRatio: false,
            interaction: {
                mode: 'index',
                intersect: false,
            },
            plugins: {
                legend: {
                    display: true,
                    position: 'top',
                    labels: {
                        color: '#333',
                        font: {
                            size: 14,
                            weight: 'bold'
                        },
                        padding: 15
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    titleColor: '#FCCC2C',
                    bodyColor: '#fff',
                    borderColor: '#5C8C4C',
                    borderWidth: 2,
                    padding: 15,
                    displayColors: true,
                    callbacks: {
                        label: function(context) {
                            let label = context.dataset.label || '';
                            if (label) {
                                label += ': ';
                            }
                            if (context.parsed.y !== null) {
                                if (label.includes('Revenue')) {
                                    label += new Intl.NumberFormat('en-US', {
                                        style: 'currency',
                                        currency: 'KWD',
                                        minimumFractionDigits: 2
                                    }).format(context.parsed.y);
                                } else {
                                    label += context.parsed.y.toLocaleString() + ' tickets';
                                }
                            }
                            return label;
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    grid: {
                        color: 'rgba(0, 0, 0, 0.1)'
                    },
                    ticks: {
                        color: '#333',
                        font: {
                            size: 12
                        }
                    }
                },
                x: {
                    grid: {
                        display: false
                    },
                    ticks: {
                        color: '#333',
                        font: {
                            size: 12
                        },
                        maxRotation: 45,
                        minRotation: 45
                    }
                }
            },
            animation: {
                duration: 1000,
                easing: 'easeInOutQuart'
            }
        };

        // Initialize charts on page load
        window.onload = function() {
            initializeCharts();
            checkDatasetStatus();
        };

        function initializeCharts() {
            // Chart 1: Line chart
            const ctx1 = document.getElementById('chart1').getContext('2d');
            chart1 = new Chart(ctx1, {
                type: 'line',
                data: { labels: [], datasets: [] },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Sales Trend Over Time',
                            color: '#333',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });

            // Chart 2: Bar chart
            const ctx2 = document.getElementById('chart2').getContext('2d');
            chart2 = new Chart(ctx2, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Top 10 Agents by Performance',
                            color: '#333',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });

            // Chart 3: Bar chart
            const ctx3 = document.getElementById('chart3').getContext('2d');
            chart3 = new Chart(ctx3, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Sales Distribution by Day of Week',
                            color: '#333',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });

            // Chart 4: Bar chart
            const ctx4 = document.getElementById('chart4').getContext('2d');
            chart4 = new Chart(ctx4, {
                type: 'bar',
                data: { labels: [], datasets: [] },
                options: {
                    ...commonOptions,
                    plugins: {
                        ...commonOptions.plugins,
                        title: {
                            display: true,
                            text: 'Hourly Sales Distribution (24-Hour Format)',
                            color: '#333',
                            font: { size: 16, weight: 'bold' }
                        }
                    }
                }
            });

            // Load initial data
            refreshAllCharts();
        }

        function getDateParams() {
            const startDate = document.getElementById('startDate').value;
            const endDate = document.getElementById('endDate').value;
            let params = '';
            if (startDate) params += `&start_date=${startDate}`;
            if (endDate) params += `&end_date=${endDate}`;
            return params;
        }

        async function updateChart1() {
            const { metric, view } = chartConfig.chart1;
            const dateParams = getDateParams();
            const response = await fetch(`/api/charts/data/by_report?metric=${metric}&view=${view}${dateParams}`);
            const data = await response.json();
            
            if (data.datasets) {
                // Both metrics
                chart1.data.labels = data.labels;
                chart1.data.datasets = [
                    {
                        label: 'Revenue (KWD)',
                        data: data.datasets[0].data,
                        borderColor: colors.green,
                        backgroundColor: colors.greenGradient(chart1.ctx),
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Tickets',
                        data: data.datasets[1].data,
                        borderColor: colors.yellow,
                        backgroundColor: colors.yellowGradient(chart1.ctx),
                        borderWidth: 3,
                        fill: true,
                        tension: 0.4,
                        yAxisID: 'y1'
                    }
                ];
                chart1.options.scales.y1 = {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    ticks: { color: '#333' }
                };
            } else {
                // Single metric
                chart1.data.labels = data.labels;
                chart1.data.datasets = [{
                    label: metric === 'revenue' ? 'Revenue (KWD)' : 'Tickets',
                    data: data.data,
                    borderColor: metric === 'revenue' ? colors.green : colors.yellow,
                    backgroundColor: metric === 'revenue' ? colors.greenGradient(chart1.ctx) : colors.yellowGradient(chart1.ctx),
                    borderWidth: 3,
                    fill: true,
                    tension: 0.4
                }];
                delete chart1.options.scales.y1;
            }
            chart1.update();
        }

        async function updateChart2() {
            const { metric } = chartConfig.chart2;
            const dateParams = getDateParams();
            const response = await fetch(`/api/charts/data/by_agent?metric=${metric}${dateParams}`);
            const data = await response.json();
            
            if (data.datasets) {
                chart2.data.labels = data.labels;
                chart2.data.datasets = [
                    {
                        label: 'Revenue (KWD)',
                        data: data.datasets[0].data,
                        backgroundColor: colors.green,
                        borderColor: colors.green,
                        borderWidth: 2
                    },
                    {
                        label: 'Tickets',
                        data: data.datasets[1].data,
                        backgroundColor: colors.yellow,
                        borderColor: colors.yellow,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ];
                chart2.options.scales.y1 = {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    ticks: { color: '#333' }
                };
            } else {
                chart2.data.labels = data.labels;
                chart2.data.datasets = [{
                    label: metric === 'revenue' ? 'Revenue (KWD)' : 'Tickets',
                    data: data.data,
                    backgroundColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderWidth: 2
                }];
                delete chart2.options.scales.y1;
            }
            chart2.update();
        }

        async function updateChart3() {
            const { metric } = chartConfig.chart3;
            const dateParams = getDateParams();
            const response = await fetch(`/api/charts/data/by_day?metric=${metric}${dateParams}`);
            const data = await response.json();
            
            if (data.datasets) {
                chart3.data.labels = data.labels;
                chart3.data.datasets = [
                    {
                        label: 'Revenue (KWD)',
                        data: data.datasets[0].data,
                        backgroundColor: colors.green,
                        borderColor: colors.green,
                        borderWidth: 2
                    },
                    {
                        label: 'Tickets',
                        data: data.datasets[1].data,
                        backgroundColor: colors.yellow,
                        borderColor: colors.yellow,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ];
                chart3.options.scales.y1 = {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    ticks: { color: '#333' }
                };
            } else {
                chart3.data.labels = data.labels;
                chart3.data.datasets = [{
                    label: metric === 'revenue' ? 'Revenue (KWD)' : 'Tickets',
                    data: data.data,
                    backgroundColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderWidth: 2
                }];
                delete chart3.options.scales.y1;
            }
            chart3.update();
        }

        async function updateChart4() {
            const { metric } = chartConfig.chart4;
            const dateParams = getDateParams();
            const response = await fetch(`/api/charts/data/by_hours?metric=${metric}${dateParams}`);
            const data = await response.json();
            
            if (data.datasets) {
                chart4.data.labels = data.labels;
                chart4.data.datasets = [
                    {
                        label: 'Revenue (KWD)',
                        data: data.datasets[0].data,
                        backgroundColor: colors.green,
                        borderColor: colors.green,
                        borderWidth: 2
                    },
                    {
                        label: 'Tickets',
                        data: data.datasets[1].data,
                        backgroundColor: colors.yellow,
                        borderColor: colors.yellow,
                        borderWidth: 2,
                        yAxisID: 'y1'
                    }
                ];
                chart4.options.scales.y1 = {
                    type: 'linear',
                    position: 'right',
                    beginAtZero: true,
                    grid: { drawOnChartArea: false },
                    ticks: { color: '#333' }
                };
            } else {
                chart4.data.labels = data.labels;
                chart4.data.datasets = [{
                    label: metric === 'revenue' ? 'Revenue (KWD)' : 'Tickets',
                    data: data.data,
                    backgroundColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderColor: metric === 'revenue' ? colors.green : colors.yellow,
                    borderWidth: 2
                }];
                delete chart4.options.scales.y1;
            }
            chart4.update();
        }

        function updateChart1Metric(btn) {
            setActiveButton(btn);
            chartConfig.chart1.metric = btn.dataset.metric;
            updateChart1();
        }

        function updateChart1View(btn) {
            setActiveButton(btn);
            chartConfig.chart1.view = btn.dataset.view;
            updateChart1();
        }

        function updateChart2Metric(btn) {
            setActiveButton(btn);
            chartConfig.chart2.metric = btn.dataset.metric;
            updateChart2();
        }

        function updateChart3Metric(btn) {
            setActiveButton(btn);
            chartConfig.chart3.metric = btn.dataset.metric;
            updateChart3();
        }

        function updateChart4Metric(btn) {
            setActiveButton(btn);
            chartConfig.chart4.metric = btn.dataset.metric;
            updateChart4();
        }

        function setActiveButton(btn) {
            const group = btn.parentElement;
            group.querySelectorAll('button').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        }

        function refreshAllCharts() {
            updateChart1();
            updateChart2();
            updateChart3();
            updateChart4();
        }

        function clearDateFilter() {
            document.getElementById('startDate').value = '';
            document.getElementById('endDate').value = '';
            refreshAllCharts();
        }

        async function checkDatasetStatus() {
            try {
                const response = await fetch('/api/sales/status');
                const data = await response.json();
                if (data.has_data) {
                    document.getElementById('datasetInfo').style.display = 'block';
                    document.getElementById('fileName').textContent = data.filename || 'Unknown';
                    document.getElementById('uploadDate').textContent = data.upload_date || 'Unknown';
                    document.getElementById('recordCount').textContent = data.record_count?.toLocaleString() || '0';
                }
            } catch (error) {
                console.error('Error checking dataset status:', error);
            }
        }

        async function login() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            
            const response = await fetch('/api/user/login', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ username, password })
            });
            
            const data = await response.json();
            if (data.success) {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminPanel').style.display = 'block';
                alert('‚úÖ Login successful!');
            } else {
                alert('‚ùå Login failed: ' + data.message);
            }
        }

        function logout() {
            fetch('/api/user/logout', { method: 'POST' });
            document.getElementById('loginForm').style.display = 'block';
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('username').value = '';
            document.getElementById('password').value = '';
        }

        async function uploadFile() {
            const fileInput = document.getElementById('fileInput');
            const file = fileInput.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            
            const response = await fetch('/api/admin/upload', {
                method: 'POST',
                body: formData
            });
            
            const data = await response.json();
            if (data.success) {
                alert(`‚úÖ Upload successful! ${data.records_imported} records imported.`);
                checkDatasetStatus();
                refreshAllCharts();
            } else {
                alert('‚ùå Upload failed: ' + data.message);
            }
            
            fileInput.value = '';
        }
    </script>
</body>
</html>
